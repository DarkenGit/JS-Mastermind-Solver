<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <title>Mastermind Solver (1â€“9, 3 Pegs)</title>
  <style>
    body { margin: 20px; }
    .guess-box { font-size: 1.5rem; font-weight: bold; margin: 10px 0; }
  </style>
</head>
<body>
<div class="container">
  <h2>Mastermind Solver</h2>
  <p>Range: <b>1â€“9</b>, Pegs: <b>3</b>, No duplicates.</p>
  
  <div id="play-area">
    <div id="cur-guess" class="guess-box"></div>

    <div id="feedback" class="form-inline mb-3">
      <label class="mr-2">Right number, right place (@):</label>
      <input type="number" id="bothCorrect" min="0" max="3" value="0" class="form-control mr-3" style="width:80px;">
      
      <label class="mr-2">Right number, wrong place (#):</label>
      <input type="number" id="colorCorrect" min="0" max="3" value="0" class="form-control mr-3" style="width:80px;">
      
      <button id="submitFeedback" class="btn btn-primary">Submit</button>
    </div>

    <div id="old-guesses-table" style="display:none;">
      <h4>History</h4>
      <table class="table table-striped">
        <thead>
          <tr><th>Guess</th><th>@ (Right Place)</th><th># (Wrong Place)</th></tr>
        </thead>
        <tbody id="old-guesses"></tbody>
      </table>
    </div>

    <div id="success" class="alert alert-success" style="display:none;">
      ðŸŽ‰ Solved! The code is found.
    </div>
    
    <div id="error" class="alert alert-danger" style="display:none;"></div>
  </div>
</div>

<script>
<script type="text/javascript">
$(function() {
  'use strict';

  const digits = ["1","2","3","4","5","6","7","8","9"];
  const numPegs = 3;

  // all possible codes (permutation without replacement)
  function generateCandidates() {
    let out = [];
    for (let i = 0; i < 9; i++) {
      for (let j = 0; j < 9; j++) {
        if (j === i) continue;
        for (let k = 0; k < 9; k++) {
          if (k === i || k === j) continue;
          out.push([digits[i], digits[j], digits[k]]);
        }
      }
    }
    return out;
  }

  // judge guess vs secret-like (feedback)
  function judge(answer, guess) {
    let both = 0, color = 0;
    let aLeft = [], gLeft = [];
    for (let i = 0; i < numPegs; i++) {
      if (answer[i] === guess[i]) both++;
      else {
        aLeft.push(answer[i]);
        gLeft.push(guess[i]);
      }
    }
    gLeft.forEach(g => {
      let idx = aLeft.indexOf(g);
      if (idx !== -1) {
        color++;
        aLeft.splice(idx,1);
      }
    });
    return {bothCorrect: both, colorCorrect: color};
  }

  // check if candidate consistent with all feedback
  function validCandidate(code, evidences) {
    return evidences.every(ev => {
      let j = judge(code, ev.guess);
      return j.bothCorrect === ev.bothCorrect && j.colorCorrect === ev.colorCorrect;
    });
  }

  // pick next guess
  function nextGuess(evidences, candidates) {
    // fixed first 3 probes
    if (evidences.length === 0) return ["1","2","3"];
    if (evidences.length === 1) return ["4","5","6"];
    if (evidences.length === 2) return ["7","8","9"];
    // else pick first valid candidate
    return candidates[0];
  }

  // UI references
  const $curGuess = $('#cur-guess');
  const $oldGuesses = $('#old-guesses');
  const $oldGuessesTable = $('#old-guesses-table');
  const $success = $('#success');

  let candidates = generateCandidates();
  let evidences = [];

  function renderGuess(guess) {
    const symbols = {"none":"â˜†", "colorCorrect":"âšª", "bothCorrect":"âš«"};
    let html = `
      <div class="guess h5">Is it maybe <b>${guess.join("")}</b>?</div>
      <div class="feedback">`;
    for (let i = 0; i < numPegs; i++) {
      html += `<span class="peg" data-state="none">${symbols.none}</span> `;
    }
    html += `<button class="btn btn-primary next">Next</button></div>`;
    $curGuess.html(html);
    $curGuess.find('.guess').data('guess', guess);
  }

  function update() {
    // filter candidates
    candidates = candidates.filter(c => validCandidate(c, evidences));
    if (candidates.length === 0) {
      $curGuess.html(`<div class="alert alert-danger">No possible codes! Check feedback.</div>`);
      return;
    }
    if (candidates.length === 1) {
      renderGuess(candidates[0]);
      return;
    }
    renderGuess(nextGuess(evidences, candidates));
  }

  // start game
  function start() {
    evidences = [];
    candidates = generateCandidates();
    $oldGuesses.empty();
    $oldGuessesTable.hide();
    $success.hide();
    update();
  }

  // click peg to cycle
  $curGuess.on('click', '.peg', function() {
    const states = ["none","colorCorrect","bothCorrect"];
    const symbols = {"none":"â˜†", "colorCorrect":"âšª", "bothCorrect":"âš«"};
    let cur = $(this).data('state');
    let next = states[(states.indexOf(cur)+1)%3];
    $(this).data('state', next).text(symbols[next]);
  });

  // press Next
  $curGuess.on('click', '.next', function() {
    let guess = $curGuess.find('.guess').data('guess');
    let both=0, color=0;
    $curGuess.find('.peg').each(function(){
      if ($(this).data('state')==="bothCorrect") both++;
      else if ($(this).data('state')==="colorCorrect") color++;
    });
    if (both === numPegs) {
      $success.show();
      return;
    }
    evidences.push({guess: guess, bothCorrect: both, colorCorrect: color});
    $oldGuessesTable.show();
    $oldGuesses.append(`<tr><td>${guess.join("")}</td><td>${both}</td><td>${color}</td></tr>`);
    update();
  });

  // init
  start();
});
</script>
</script>
</body>
</html>
 
